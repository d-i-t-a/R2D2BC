<!--
 * Copyright 2018-2020 DITA (AM Consulting LLC)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Developed on behalf of: Bokbasen AS (https://www.bokbasen.no)
 * Licensed to: Bokbasen AS and CAST under one or more contributor license agreements.
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <title>D2 Reader</title>
    <meta charset="utf-8" />
    <meta name="author" content="Aferdita Muriqi" />
    <meta name="description" content="A viewer application for EPUB files." />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

    <!-- R2 Reader CSS -->
    <link rel="stylesheet" href="reader.css" />

    <script> var exports = {}; </script>
    <script src="reader.js"></script>

    <!-- Material Icons-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- START Material CSS -->
    <!-- Material header and footer CSS  - uncomment if  custom header an d footer is provided-->
    <link rel="stylesheet" href="material.css" />
    <!-- END Material CSS -->
</head>

<body>

    <div class="content" id="root">
        <header id="headerMenu">
            <div class="navbar-fixed">
                <nav class="navbar">
                    <div class="nav-wrapper"><span class="brand-logo  hide-on-med-and-down " id="book-title"></span>
                        <ul id="nav-mobile-right" class="right">
                            <li style="display:none"><a class="saveBookmark" id="menu-button-bookmark"><i
                                       class="material-icons ">bookmark</i></a></li>
                            <li><a data-target="container-view-settings" class="dropdown-trigger "
                                   id="menu-button-settings"><i class="material-icons ">settings</i></a></li>
                        </ul>
                        <ul id="nav-mobile-left" class="left">
                            <li><a href="#!" data-target="sidenav-left" class="sidenav-trigger left"><i
                                       class="material-icons  show-on-large">menu</i></a></li>
                            <li><a rel="prev" style="padding-left: 7px; padding-right: 7px;"><i
                                       class="material-icons ">arrow_back_ios</i></a></li>
                            <li><a rel="next" style="padding-left: 7px; padding-right: 7px;"><i
                                       class="material-icons ">arrow_forward_ios</i></a></li>
                        </ul>
                    </div>
                </nav>
            </div>
            <ul id="sidenav-left" class="sidenav">
                <li><a href="#" class="logo-container ">D2 Reader<i class="material-icons  left"
                           style="margin-right: 15px">
                            import_contacts
                        </i><i class="material-icons right  editAnnotations" id="expand-menu">unfold_more</i></a></li>
                <li class="no-padding ">
                    <ul class="collapsible collapsible-accordion">
                        <li class="bold" id="sidenav-section-toc"><a class="collapsible-header ">Table of Contents<i
                                   class="material-icons chevron purple-yellow-text">chevron_left</i></a>
                            <div id="container-view-toc" class="contents-view collapsible-body active"
                                 style="background-color : #ffffff">
                            </div>
                        </li>
                        <li class="bold " id="sidenav-section-bookmarks"><a class="collapsible-header ">Bookmarks <i
                                   class="material-icons chevron ">chevron_left</i></a>
                            <div id="container-view-bookmarks" class="bookmarks-view collapsible-body active"
                                 style="background-color : #ffffff">
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
            <div id="container-view-settings" class="dropdown-content settings-view notifications">
                <ul class="settings-menu" role="menu" tabindex="0">
                    <li id="container-view-fontsize">
                        <ul class="settings-options">
                            <li class="font-setting"><button id="decrease-font" class="decrease" role="menuitem"
                                        tabindex="-1" onclick="javascript:D2Reader.decrease('fontSize')">A-</button></li>
                            <li class="font-setting"><button id="increase-font" class="increase" role="menuitem"
                                        tabindex="-1" onclick="javascript:D2Reader.increase('fontSize')">A+</button></li>
                        </ul>
                    </li>
                    <li id="container-view-appearance">
                        <ul class="settings-options">
                            <li class="reading-theme"><button onclick="javascript:D2Reader.applyUserSettings({appearance:'day'})" id="day-theme" class="day-theme" role="menuitem"
                                        tabindex="-1" aria-label="Day mode enabled">Day<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>
                            <li class="reading-theme"><button onclick="javascript:D2Reader.applyUserSettings({appearance:'sepia'})" id="sepia-theme" class="sepia-theme" role="menuitem"
                                        tabindex="-1" aria-label="Sepia mode disabled">Sepia<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>
                            <li class="reading-theme"><button onclick="javascript:D2Reader.applyUserSettings({appearance:'night'})" id="night-theme" class="night-theme" role="menuitem"
                                        tabindex="-1" aria-label="Night mode disabled">Night<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>
                        </ul>
                    </li>
                    <li id="container-view-scroll">
                        <ul class="settings-options">
                            <li class="reading-view"><button onclick="javascript:D2Reader.scroll(true)" id="view-scroll" class="view-scroll" role="menuitem"
                                        tabindex="-1" aria-label="Scroll view enabled" >Scroll<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>

                            <li class="reading-view"><button onclick="javascript:D2Reader.scroll(false)" id="view-paginated" class="view-paginated" role="menuitem"
                                        tabindex="-1" aria-label="Paginated view disabled">Paginated<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>
                        </ul>
                    </li>
                    <li id="container-view-fontfamily">
                        <ul class="settings-options">

                            <li class="reading-style"><button onclick="javascript:D2Reader.applyUserSettings({fontFamily:'Original'})" id="publisher-font" class="publisher-font" role="menuitem"
                                        tabindex="-1" aria-label="Publisher font enabled">Publisher<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>

                            <li class="reading-style"><button onclick="javascript:D2Reader.applyUserSettings({fontFamily:'serif'})" id="serif-font" class="serif-font" role="menuitem"
                                        tabindex="-1" aria-label="Serif font disabled">Serif<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>

                            <li class="reading-style"><button onclick="javascript:D2Reader.applyUserSettings({fontFamily:'sans-serif'})" id="sans-font" class="sans-font" role="menuitem"
                                        tabindex="-1" aria-label="Sans-serif font disabled">Sans-serif<svg
                                         xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"
                                         class="checkedIcon" role="img" aria-labelledby="check-icon">
                                        <use xlink:href="#check-icon"></use>
                                    </svg></button></li>

                        </ul>
                    </li>
                </ul>
            </div>
        </header>

        <div id="D2Reader-Container" style="width: 100%; height: 100%; position: relative;">
            <main style="overflow: hidden" tabindex=-1 id="iframe-wrapper">
                <div id="reader-loading" class="loading"></div>
                <div id="reader-error" class="error"></div>
                <div id="reader-info-top" class="info top">
                    <span class="book-title"></span>
                </div>
                <div id="reader-info-bottom-flex" class="info bottom">
                    <span class="chapter-position"></span>
                    <span class="chapter-title"></span>
                </div>
            </main>

            <div id="container-view-security" class="security"></div>

            <a id="previous-chapter" rel="prev" role="button" aria-labelledby="previous-label"
               style="top: 65px;left: 50%;position: fixed;color: #000;height: 24px;background: #d3d3d33b; width: 150px;transform: translate(-50%, 0); display: none">
                <i class="material-icons black-text" style="left: calc(50% - 12px);
                position: relative;">keyboard_arrow_up</i>
            </a>
            <a id="next-chapter" rel="next" role="button" aria-labelledby="next-label"
               style="bottom: 0;left: 50%;position: fixed;color: #000;height: 24px;background: #d3d3d33b; width: 150px;transform: translate(-50%, 0); display: none">
                <i class="material-icons black-text" style="left: calc(50% - 12px);
                position: relative;">keyboard_arrow_down</i>
            </a>

            <span id="highlight-toolbox" class="highlight-toolbox">
                <div id="highlight-toolbox-mode-colors">
                    <button style="background-color: gainsboro;" id="dismissIcon"><i class="material-icons"
                           style="color:gray">close</i></button>
                </div>
                <div id="highlight-toolbox-mode-add">
                    <button style="display: unset;" id="colorIcon" class="color-option"><span></span></button>
                    <button style="background-color: gainsboro;" id="highlightIcon"><span
                              style="background: yellow;display: inline-block;width: 24px;height: 24px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 preserveAspectRatio="xMidYMid meet" role="img" class="icon open"
                                 aria-labelledby="text-icon">
                                <title id="text-icon">Text</title>
                                <path d="M5 4v3h5.5v12h3V7H19V4z"></path>
                            </svg>
                        </span></button>
                    <button style="background-color: gainsboro;" id="underlineIcon"><span
                              style="display: inline-block;width: 24px;height: 24px;border-bottom: yellow solid 4px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 preserveAspectRatio="xMidYMid meet" role="img" class="icon open"
                                 aria-labelledby="text-icon">
                                <title id="text-icon">Text</title>
                                <path d="M5 4v3h5.5v12h3V7H19V4z"></path>
                            </svg>
                        </span></button>
                    <button style="background-color: gainsboro;" id="speakIcon"><span
                              style="display: inline-block;width: 24px;height: 24px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 preserveAspectRatio="xMidYMid meet" role="img" class="icon open"
                                 aria-labelledby="speak-icon">
                                <title id="speak-icon">Speak</title>
                                <circle cx="9" cy="9" r="4"></circle>
                                <path
                                      d="M9 15c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4zm7.76-9.64l-1.68 1.69c.84 1.18.84 2.71 0 3.89l1.68 1.69c2.02-2.02 2.02-5.07 0-7.27zM20.07 2l-1.63 1.63c2.77 3.02 2.77 7.56 0 10.74L20.07 16c3.9-3.89 3.91-9.95 0-14z">
                                </path>
                                <path d="M0 0h24v24H0z" fill="none"></path>
                            </svg>
                        </span></button>
                </div>
                <div id="highlight-toolbox-mode-edit">
                    <button style="background-color: gainsboro;display: none" id="deleteIcon"><i class="material-icons"
                           style="color:gray">delete</i></button>
                </div>
            </span>

        </div>

        <footer id="footerMenu">
            <a rel="prev" class="disabled" role="button" aria-labelledby="previous-label" style="top: 50%;left:0;position: fixed;height: 100px;
                    background: #d3d3d33b;">
                <i class="material-icons black-text" style="top: calc(50% - 12px);
                        position: relative;">keyboard_arrow_left</i>
            </a>
            <a rel="next" class="disabled" role="button" aria-labelledby="next-label" style="top: 50%;right:0;position: fixed;height: 100px;
                    background: #d3d3d33b;">
                <i class="material-icons black-text" style="top: calc(50% - 12px);
                        position: relative;">keyboard_arrow_right</i>
            </a>
        </footer>
    </div>

    <script>
        var getURLQueryParams = function () {
            var params = {};
            var query = window.location.search;
            if (query && query.length) {
                query = query.substring(1);
                var keyParams = query.split('&');
                for (var x = 0; x < keyParams.length; x++) {
                    var keyVal = keyParams[x].split('=');
                    if (keyVal.length > 1) {
                        params[keyVal[0]] = decodeURIComponent(keyVal[1]);
                    }
                }
            }
            return params;
        };
        var urlParams = getURLQueryParams();
        var upLink = { url: new URL("/", window.location.href), label: "Back", ariaLabel: "Go back" };

        var injectables = [
            { type: 'style', url: '/viewer/readium-css/ReadiumCSS-before.css', r2before: true },
            { type: 'style', url: '/viewer/readium-css/ReadiumCSS-default.css', r2default: true },
            { type: 'style', url: '/viewer/readium-css/ReadiumCSS-after.css', r2after: true },
            { type: 'style', url: '/viewer/injectables/pagebreak/pagebreak.css', r2after: true },
            { type: 'script', url: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML&latest' },
            // { type: 'style', url: '/viewer/fonts/opendyslexic/opendyslexic.css', fontFamily: 'opendyslexic' },
            { type: 'script', url: '/viewer/injectables/footnotes/footnotes.js' },
            { type: 'style', url: '/viewer/injectables/footnotes/footnotes.css' },
            { type: 'style', url: '/viewer/injectables/style/style.css' },
        ]

        D2Reader.load({
            url: new URL(urlParams['url']),
            rights: {
                enableMaterial: true,
                enableBookmarks: true,
                enableAnnotations: true,
                enableTTS: true,
                enableContentProtection: true,
            },
            attributes: {
                margin: 60,
                iframePaddingTop: 20,
            },
            tts: {
                enableSplitter: false,
                color: "orange",
                autoScroll: true,
                voice: {
                    usePublication: false//, // true = will be used no matter if an initial language is set, false = ignore publicaiton language
                    // lang: "de_DE" // initial language, default system language will be used it this language can't be found
                    // name: "Karen" // will be only used together with the lang, if lang is not given, name will be ignored
                },
                api: {
                    updateSettings: function (settings) {
                        console.log("updateSettings")
                        return new Promise(function (resolve, reject) {
                            resolve(
                                settings
                            )
                        })
                    }
                }
            },
            highlighter: {
                // selectionMenuItems: selectionMenuItems,
            },
            annotations: {
                initialAnnotationColor: "var(--RS__highlightColor)",
                // initialAnnotationColor: "#ff8500",
            },
            protection: {
                enforceSupportedBrowsers: true,
                enableEncryption: true, // does nothing right now
                enableObfuscation: true,
                disablePrint: true,
                disableCopy: true,
                detectInspect: false,
                clearOnInspect: false, // make sure detectInspect is true, otherwise this won't work
                disableKeys: true,
                disableContextMenu: true,
                hideTargetUrl: true,
                disableDrag: false,
                api: {
                    // make sure detectInspect is true, otherwise this won't be called
                    // this callback will be executed in a loop while inspect is visible
                    inspectDetected: function () {
                        console.log("inspect detected")
                    },
                }
            },
            api: {
            },
            injectables: injectables
        }).then(instance => {
            console.log("D2Reader loaded ", instance);
            console.log("instance.bookmarkModule ", instance.bookmarkModule)
            console.log("instance.annotationModule ", instance.annotationModule)
        }).catch(error => {
            console.error("error.message ", error.message);
        });

    </script>

    <!-- START Material Scripts -->
    <!-- Compiled and minified Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <noscript>
        <style>
            noscript {
                width: 100%;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .warning {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                font-size: 1.5rem;
                font-weight: bold;
            }
        </style>
        <p class="warning">To use this viewer, please enable JavaScript.</p>
    </noscript>
</body>

</html>
